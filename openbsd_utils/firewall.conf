# OpenBSD PF Firewall Configuration
# /etc/pf.conf

# Macros
ext_if = "em0"
int_if = "em1"
tcp_services = "{ ssh, http, https }"
icmp_types = "{ echoreq, unreach }"

# Options
set skip on lo0
set block-policy drop
set loginterface $ext_if

# Normalization
match in all scrub (no-df random-id max-mss 1440)

# NAT
match out on $ext_if inet from $int_if:network to any nat-to ($ext_if)

# Default deny
block all

# Allow loopback
pass quick on lo0 all

# Allow outbound from firewall
pass out quick on $ext_if inet proto tcp all modulate state
pass out quick on $ext_if inet proto udp all keep state
pass out quick on $ext_if inet proto icmp all keep state

# Allow inbound services
pass in on $ext_if inet proto tcp to ($ext_if) port $tcp_services modulate state
pass in inet proto icmp icmp-type $icmp_types keep state

# Allow internal network
pass in on $int_if from $int_if:network to any keep state
pass out on $int_if from any to $int_if:network keep state
